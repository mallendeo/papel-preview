{"version":3,"sources":["main.js"],"names":["acceptedOrigins","state","ready","html","code","loaded","css","js","styleElem","document","querySelector","createScript","jsEl","parentNode","removeChild","script","createElement","inlineScript","createTextNode","appendChild","id","body","updateHtml","selector","elems","querySelectorAll","forEach","el","fakeElem","innerHTML","Array","from","childNodes","reverse","elem","node","nodeName","insertBefore","firstChild","update","lang","opts","forceRefresh","window","addEventListener","data","event","origin","indexOf","type","output","error","title","langs","allLoaded","some","l"],"mappings":"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","file":"main.6fdaa578.map","sourceRoot":"../src","sourcesContent":[";(() => {\n  const acceptedOrigins = [\n    'http://localhost:3000', // nuxt\n    'https://papel.app'\n  ]\n\n  const state = {\n    ready: false,\n    html: {\n      code: '',\n      loaded: false\n    },\n    css: {\n      code: '',\n      loaded: false\n    },\n    js: {\n      code: '',\n      loaded: false\n    }\n  }\n\n  const styleElem = document.querySelector('#__papel-preview-style')\n\n  const createScript = code => {\n    const jsEl = document.querySelector('#__papel-preview-script')\n    if (jsEl) jsEl.parentNode.removeChild(jsEl)\n\n    const script = document.createElement('script')\n    const inlineScript = document.createTextNode(code)\n    script.appendChild(inlineScript)\n    script.id = '__papel-preview-script'\n    document.body.appendChild(script)\n    return code\n  }\n\n  const updateHtml = code => {\n    const selector = 'body *:not(#__papel-preview-script):not(#__papel-init-script)'\n    const elems = document.querySelectorAll(selector)\n    elems.forEach(el => el.parentNode.removeChild(el))\n\n    const fakeElem = document.createElement('div')\n    fakeElem.innerHTML = code\n\n    Array.from(fakeElem.childNodes).reverse().forEach(node => {\n      let elem = node\n\n      if (node.nodeName === 'SCRIPT') {\n        elem = document.createElement('script')\n        elem.appendChild(document.createTextNode(node.innerHTML))\n      }\n      document.body.insertBefore(elem, document.body.firstChild)\n    })\n  }\n\n  const update = (lang, opts) => {\n    switch (lang) {\n      case 'html':\n        if (opts.forceRefresh) {\n          document.body.innerHTML = state.html.code\n          createScript(state.js.code)\n          return\n        }\n\n        updateHtml(state.html.code)\n        break\n      case 'css':\n        styleElem.innerHTML = state.css.code\n        break\n      case 'js':\n        createScript(state.js.code)\n        break\n    }\n  }\n\n  window.addEventListener('message', event => {\n    const { data, origin } = event\n    if (acceptedOrigins.indexOf(origin) < 0) return\n\n    if (!data && !data.type) return\n\n    if (data.type === 'papel:codeupdate') {\n      const { output, error, lang, opts = {} } = data.event\n      if (error) return\n\n      document.title = opts.title || 'Papel Preview'\n\n      state[lang].code = output\n      state[lang].loaded = true\n\n      const langs = ['html', 'css', 'js']\n      const allLoaded = !langs.some(l => !state[l].loaded)\n\n      if (!allLoaded) return\n      if (!state.ready) {\n        langs.forEach(update)\n        state.ready = true\n        return\n      }\n\n      update(lang, opts)\n    }\n  }, false)\n})()\n"]}